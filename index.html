<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema Premium S77</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:black;
  color:#fff;
  text-align:center;
  padding:20px;
}
.panel{
  max-width:560px;
  margin:15px auto;
  padding:15px;
  border-radius:12px;
  background:black;
}
.hidden{display:none}
input,button{
  padding:10px;
  border-radius:8px;
  border:none;
  margin:5px;
}
button{
  font-weight:bold;
}
button.reset{
  background:green;
  color:white;
}
.inputs{
  display:grid;
  grid-template-columns:repeat(4,70px);
  gap:12px;
  justify-content:center;
}
.inputs input{
  width:70px;height:70px;
  font-size:34px;
  font-weight:bold;
  text-align:center;
  border:4px solid red;
  background:white;
  color:black;
}
.nuevo{
  width:80px;height:80px;
  font-size:36px;
  font-weight:bold;
  border:4px solid red;
  background:#7fd3ff;
}
.box input{
  width:90px;
  height:45px;
  font-size:24px;
  background:#111;
  color:white;
}
.control{
  display:grid;
  grid-template-columns:1fr auto 1fr;
  gap:20px;
  align-items:start;
  justify-content:center;
}
.col{
  display:flex;
  flex-direction:column;
  gap:8px;
  align-items:center;
}
.favoritos{
  background:green;
  font-size:24px;
  padding:10px;
  border-radius:8px;
}
.explosivos{
  background:red;
  font-size:40px;
  padding:10px;
  border-radius:8px;
}
</style>
</head>

<body>

<h1>ðŸŽ¡ Sistema Premium S77</h1>

<div class="panel" id="s77">

  <h2>ÃšLTIMOS 16 NÃšMEROS</h2>
  <div class="inputs">
    <input disabled><input disabled><input disabled><input disabled>
    <input disabled><input disabled><input disabled><input disabled>
    <input disabled><input disabled><input disabled><input disabled>
    <input disabled><input disabled><input disabled><input disabled>
  </div>

  <h3>NUEVO NÃšMERO</h3>

  <div class="control">
    <div class="col box">
      <div>A</div><input id="A" disabled value="0">
      <div>B</div><input id="B" disabled value="0">
      <button class="reset" onclick="reiniciar()">REINICIAR</button>
    </div>

    <div class="col">
      <input class="nuevo" id="nuevoNumero" type="number">
    </div>

    <div class="col box">
      <div>C</div><input id="C" disabled value="1">
      <div>D</div><input id="D" disabled value="0">
      <div>E</div><input id="E" disabled value="0">
    </div>
  </div>

  <h3>FAVORITOS</h3>
  <div class="favoritos" id="fav">â€”</div>

  <h3>EXPLOSIVOS</h3>
  <div class="explosivos" id="exp">â€”</div>
</div>

<script>
const API = "https://s77-backend.onrender.com";

let ultimos = [];
let B = 0;
let E = 0;
let sistemaActivo = false;

const cas = [...document.querySelectorAll(".inputs input")];

document.getElementById("nuevoNumero").onchange = async e => {
  const v = parseInt(e.target.value);
  if (isNaN(v)) return;

  ultimos.unshift(v);
  if (ultimos.length > 16) ultimos.pop();
  render();

  if (ultimos.length === 16 && !sistemaActivo) {
    sistemaActivo = true;
    e.target.value = "";
    return;
  }
  if (!sistemaActivo) {
    e.target.value = "";
    return;
  }

  const r = await fetch(API + "/calcular", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ ultimos })
  });
  const d = await r.json();

  // A = total
  const A = d.favoritos.length + d.explosivos.length;
  document.getElementById("A").value = A;

  // B acumula A
  B += A;
  document.getElementById("B").value = B;

  // C por segmentos de 25 sobre B
  const C = Math.floor(B / 25) + 1;
  document.getElementById("C").value = C;

  // D = A Ã— C
  const D = A * C;
  document.getElementById("D").value = D;

  // E acumula D
  E += D;
  document.getElementById("E").value = E;

  document.getElementById("fav").innerText =
    d.favoritos.length ? d.favoritos.join(", ") : "â€”";
  document.getElementById("exp").innerText =
    d.explosivos.length ? d.explosivos.join(", ") : "â€”";

  e.target.value = "";
};

function render(){
  cas.forEach((c,i)=>c.value = ultimos[i] ?? "");
}

function reiniciar(){
  B = 0;
  E = 0;
  document.getElementById("B").value = 0;
  document.getElementById("C").value = 1;
  document.getElementById("D").value = 0;
  document.getElementById("E").value = 0;
}
</script>

</body>
</html>
