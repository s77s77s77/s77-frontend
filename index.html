<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema Premium S77</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:black;
  color:#fff;
  text-align:center;
  padding:20px;
}
.panel{
  max-width:580px;
  margin:15px auto;
  padding:15px;
  border-radius:12px;
  background:black;
}
.hidden{display:none}

input,select,button{
  padding:10px;
  border-radius:8px;
  border:none;
  margin:5px;
}
button{
  background:maroon;
  color:white;
  font-weight:bold;
}

.inputs{
  display:grid;
  grid-template-columns:repeat(4,70px);
  gap:12px;
  justify-content:center;
}
.inputs input{
  width:70px;height:70px;
  font-size:34px;
  font-weight:bold;
  text-align:center;
  border:4px solid red;
  background:white;
  color:black;
}
.inputs input:first-child{background:#7fd3ff;}

.nuevo{
  width:70px;height:70px;
  font-size:34px;
  font-weight:bold;
  text-align:center;
  border:4px solid red;
  background:#7fd3ff;
}

.favoritos{
  background:green;
  font-size:26px;
  padding:15px;
  border-radius:8px;
}
.explosivos{
  background:red;
  font-size:48px;
  padding:15px;
  border-radius:8px;
}

.box input{
  width:95px;
  height:52px;
  font-size:28px;
  text-align:center;
  border-radius:8px;
  font-family:"Segoe UI",Arial,sans-serif;
}

#total{background:#666;color:white;}
#fichas{background:black;color:#00ff66;}
#gastos{background:black;color:red;}
#diferencia{background:red;color:black;}

.pulse{animation:pulse .6s ease-in-out;}
@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.15)}
  100%{transform:scale(1)}
}
</style>
</head>

<body>

<h1>ðŸŽ¡ Sistema Premium S77</h1>

<!-- LOGIN -->
<div class="panel" id="login">
  <h2>INGRESAR CLAVE</h2>
  <input id="clave">
  <br>
  <button onclick="login()">INGRESAR</button>
  <p id="error" style="color:red;"></p>
</div>

<!-- ADMIN -->
<div class="panel hidden" id="admin">
  <h2>ADMINISTRADOR</h2>
  <input id="nuevaClave" placeholder="Clave usuario">
  <select id="dias">
    <option value="1">1 dÃ­a</option>
    <option value="7">7 dÃ­as</option>
    <option value="30">30 dÃ­as</option>
  </select>
  <br>
  <button onclick="crearUsuario()">CREAR USUARIO</button>
</div>

<!-- SISTEMA -->
<div class="panel hidden" id="s77">

<h2>ÃšLTIMOS 16 NÃšMEROS</h2>
<div class="inputs">
  <input disabled><input disabled><input disabled><input disabled>
  <input disabled><input disabled><input disabled><input disabled>
  <input disabled><input disabled><input disabled><input disabled>
  <input disabled><input disabled><input disabled><input disabled>
</div>

<h3>NUEVO NÃšMERO</h3>

<div style="display:flex;justify-content:center;gap:20px;align-items:flex-start;">

  <div class="box">
    <strong>GASTOS</strong><br>
    <input id="gastos" disabled><br><br>
    <strong>DIFERENCIA</strong><br>
    <input id="diferencia" disabled>
  </div>

  <div>
    <input class="nuevo" id="nuevoNumero" type="number"><br>
    <button onclick="reiniciar()">REINICIAR</button>
  </div>

  <div class="box">
    <strong>TOTAL</strong><br>
    <input id="total" disabled><br><br>
    <strong>FICHAS</strong><br>
    <input id="fichas" disabled>
  </div>

</div>

<h3>FAVORITOS</h3>
<div class="favoritos" id="fav">â€”</div>

<h3>EXPLOSIVOS</h3>
<div class="explosivos" id="exp">â€”</div>

</div>

<script>
const API="https://s77-backend.onrender.com";

let ultimos=[];
let adminClave=null;

let gastos=0;
let diferencia=0;
let totalAcumParaFichas=0;

const cas=[...document.querySelectorAll(".inputs input")];

/* LOGIN */
async function login(){
  const clave=document.getElementById("clave").value;
  const r=await fetch(API+"/login",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({clave})
  });
  const d=await r.json();
  if(!d.ok){
    document.getElementById("error").innerText=d.error||"FORBIDDEN";
    return;
  }
  document.getElementById("login").classList.add("hidden");
  document.getElementById("s77").classList.remove("hidden");
  if(d.admin){
    adminClave=clave;
    document.getElementById("admin").classList.remove("hidden");
  }
}

async function crearUsuario(){
  const nuevaClave=document.getElementById("nuevaClave").value;
  const dias=document.getElementById("dias").value;
  await fetch(API+"/crear-usuario",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({adminClave,nuevaClave,dias})
  });
  alert("Usuario creado");
}

/* SISTEMA */
document.getElementById("nuevoNumero").onchange=async e=>{
  const v=parseInt(e.target.value);
  if(isNaN(v))return;

  ultimos.unshift(v);
  if(ultimos.length>16)ultimos.pop();
  cas.forEach((c,i)=>c.value=ultimos[i]??"");

  const r=await fetch(API+"/calcular",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ultimos})
  });
  const d=await r.json();

  document.getElementById("fav").innerText=d.favoritos.length?d.favoritos.join(", "):"â€”";
  document.getElementById("exp").innerText=d.explosivos.length?d.explosivos.join(", "):"â€”";

  if(ultimos.length<16){
    e.target.value="";
    return;
  }

  const totalIngreso=d.favoritos.length+d.explosivos.length;
  document.getElementById("total").value=totalIngreso;

  gastos+=totalIngreso;
  diferencia=-gastos;

  totalAcumParaFichas+=totalIngreso;
  const fichas=1+Math.floor(totalAcumParaFichas/25);

  if(d.completed){
    diferencia+=fichas*36;
    totalAcumParaFichas=0;
    gastos=0;
  }

  document.getElementById("gastos").value=gastos;
  document.getElementById("fichas").value=fichas;
  document.getElementById("diferencia").value=diferencia;

  const diff=document.getElementById("diferencia");
  if(diferencia>=0){
    diff.style.background="#6ecbff";
    diff.style.color="black";
  }else{
    diff.style.background="red";
    diff.style.color="black";
  }

  const f=document.getElementById("fichas");
  f.classList.remove("pulse"); void f.offsetWidth; f.classList.add("pulse");

  e.target.value="";
};

function reiniciar(){
  ultimos=[];
  cas.forEach(c=>c.value="");
  gastos=0;
  diferencia=0;
  totalAcumParaFichas=0;
  total.value=gastos.value=fichas.value=diferencia.value="";
  fav.innerText="â€”";
  exp.innerText="â€”";
}
</script>

</body>
  </html>
                                  
