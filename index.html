<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema Premium S77</title>

<style>
body{
  font-family: Arial, sans-serif;
  background: black;
  color: #fff;
  text-align: center;
  padding: 20px;
}

.panel{
  max-width: 520px;
  margin: 15px auto;
  padding: 15px;
  border-radius: 12px;
  background: black;
}

.hidden{ display:none }

input,select,button{
  padding:10px;
  border-radius:8px;
  border:none;
  margin:5px;
}

button{
  background:maroon;
  color:white;
  font-weight:bold;
}

.inputs{
  display:grid;
  grid-template-columns:repeat(4,70px);
  gap:12px;
  justify-content:center;
}

.inputs input,
.inputs5 input{
  width:70px;
  height:70px;
  font-size:34px;
  font-weight:bold;
  text-align:center;
  border:4px solid red;
  background:white;
  color:black;
}

.inputs5{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-top:10px;
}

.nuevo{
  width:70px;
  height:70px;
  font-size:34px;
  font-weight:bold;
  text-align:center;
  border:4px solid red;
  background:#7fd3ff;
}

/* ======================
   LOTES ‚Äî VISUAL
   ====================== */

/* contenedor m√°s angosto, centrado bajo el bot√≥n */
.lotes-wrapper{
  margin-top:25px;
  width: 420px;        /* controla d√≥nde cae el centro */
  margin-left:auto;
  margin-right:auto;
}

.lotes-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
}

.lote-box{
  display:grid;
  grid-template-columns: 1fr 70px;
  gap:10px;
}

.lote-numeros{
  height:55px;
  border-radius:10px;
  background:#111;
  border:3px solid #444;
  color:#fff;
  font-size:24px;
  font-weight:bold;
  text-align:center;
  letter-spacing:6px;
}

.lote-caramelos{
  height:55px;
  border-radius:10px;
  background:#222;
  border:3px solid #888;
  color:yellow;
  font-size:30px;
  font-weight:bold;
  text-align:center;
}
</style>
</head>

<body>

<h1>üé° Sistema Premium S77</h1>

<!-- LOGIN -->
<div class="panel" id="login">
  <h2>INGRESAR CLAVE</h2>
  <input id="clave">
  <br>
  <button onclick="login()">INGRESAR</button>
  <p id="error" style="color:red;"></p>
</div>

<!-- ADMIN -->
<div class="panel hidden" id="admin">
  <h2>ADMINISTRADOR</h2>
  <input id="nuevaClave" placeholder="Clave usuario">
  <select id="dias">
    <option value="1">1 d√≠a</option>
    <option value="7">7 d√≠as</option>
    <option value="30">30 d√≠as</option>
  </select>
  <br>
  <button onclick="crearUsuario()">CREAR USUARIO</button>
</div>

<!-- S77 -->
<div class="panel hidden" id="s77">

  <h2>√öLTIMOS N√öMEROS</h2>

  <div id="zonaNumeros">

    <div class="inputs" id="vista16">
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
    </div>

    <div class="inputs5 hidden" id="vista5">
      <input disabled>
      <input disabled>
      <input disabled>
      <input disabled>
      <input disabled>
    </div>

  </div>

  <h3>NUEVO N√öMERO</h3>

  <div style="display:flex; justify-content:center; gap:20px; align-items:flex-start;">
    <div>
      <input class="nuevo" id="nuevoNumero" type="number">
      <br>
      <button onclick="reiniciar()">REINICIAR</button>
    </div>
  </div>

  <!-- LOTES (16) -->
  <div class="lotes-wrapper">
    <div class="lotes-grid" id="zonaLotes">
      <!-- se genera por JS -->
    </div>
  </div>

</div>

<script>
const API = "https://s77-backend.onrender.com";
let ultimos = [];
let adminClave = null;

const cas16 = [...document.querySelectorAll("#vista16 input")];
const cas5 = [...document.querySelectorAll("#vista5 input")];

async function login(){
  const clave = document.getElementById("clave").value;

  const r = await fetch(API + "/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ clave })
  });

  const d = await r.json();

  if (!d.ok) {
    document.getElementById("error").innerText = d.error || "FORBIDDEN";
    return;
  }

  document.getElementById("login").classList.add("hidden");
  document.getElementById("s77").classList.remove("hidden");

  if (d.admin) {
    adminClave = clave;
    document.getElementById("admin").classList.remove("hidden");
  }
}

async function crearUsuario(){
  const nuevaClave = document.getElementById("nuevaClave").value;
  const dias = document.getElementById("dias").value;

  await fetch(API + "/crear-usuario", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ adminClave, nuevaClave, dias })
  });

  alert("Usuario creado");
}

document.getElementById("nuevoNumero").onchange = async e => {
  const v = parseInt(e.target.value);
  if (isNaN(v)) return;

  ultimos.unshift(v);
  if (ultimos.length > 16) ultimos.pop();

  render();

  // seguimos usando el backend igual para el resto,
  // pero ya sin total / favoritos / explosivos en pantalla
  if (ultimos.length >= 16){
    await fetch(API + "/calcular", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ultimos })
    });
  }

  e.target.value = "";
};

function render(){
  cas16.forEach((c,i)=> c.value = ultimos[i] ?? "");

  if (ultimos.length >= 16){
    const vista16 = document.getElementById("vista16");
    const vista5 = document.getElementById("vista5");

    if (vista16) vista16.remove();

    vista5.classList.remove("hidden");

    const ult5 = ultimos.slice(0,5);
    cas5.forEach((c,i)=> c.value = ult5[i] ?? "");
  }
}

function reiniciar(){
  ultimos = [];
  location.reload();
}

/* ======================================================
   LOTES ‚Äî GENERACI√ìN + C√ÅLCULO DE CARAMELOS
   ====================================================== */

const zona = document.getElementById("zonaLotes");

// crear 16 casilleros
for(let i=0;i<16;i++){
  const row = document.createElement("div");
  row.className = "lote-box";

  row.innerHTML = `
    <input class="lote-numeros" id="lote_nums_${i}" disabled>
    <input class="lote-caramelos" id="lote_car_${i}" disabled>
  `;

  zona.appendChild(row);
}

const LOTES = Array.from({length:16}).map(()=>({
  activa:false,
  gasto:0,
  busca:[]
}));

// regla: base 1, +1 cada 20
function setBusqueda(loteIndex, numeros, gastoNuevo){
  const n = document.getElementById("lote_nums_"+loteIndex);
  const c = document.getElementById("lote_car_"+loteIndex);

  LOTES[loteIndex].busca = numeros;
  LOTES[loteIndex].gasto += gastoNuevo;

  n.value = numeros.join(" ");

  const caramelos = Math.floor(LOTES[loteIndex].gasto / 20) + 1;
  c.value = caramelos;
}

/* DEMO visual ‚Äî pod√©s borrar cuando quieras */
setBusqueda(0,[13,36,27],22);
setBusqueda(1,[6,27,13],5);

</script>

</body>
        </html>
  
