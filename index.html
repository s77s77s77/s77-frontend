<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema Premium S77</title>

<style>
body{
  font-family: Arial, sans-serif;
  background: black;
  color: #fff;
  text-align: center;
  padding: 20px;
}

.panel{
  max-width: 520px;
  margin: 15px auto;
  padding: 15px;
  border-radius: 12px;
  background: black;
}

.hidden{ display:none }

input,select,button{
  padding:10px;
  border-radius:8px;
  border:none;
  margin:5px;
}

button{
  background:maroon;
  color:white;
  font-weight:bold;
}

.inputs{
  display:grid;
  grid-template-columns:repeat(4,70px);
  gap:12px;
  justify-content:center;
}

.inputs input,
.inputs5 input{
  width:70px;
  height:70px;
  font-size:34px;
  font-weight:bold;
  text-align:center;
  border:4px solid red;
  background:white;
  color:black;
}

.inputs5{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-top:10px;
}

.nuevo{
  width:70px;
  height:70px;
  font-size:34px;
  font-weight:bold;
  text-align:center;
  border:4px solid red;
  background:#7fd3ff;
}

.favoritos{
  background:green;
  font-size:26px;
  padding:15px;
  border-radius:8px;
}

.explosivos{
  background:red;
  font-size:48px;
  padding:15px;
  border-radius:8px;
}

.totalBox input{
  width:80px;
  height:50px;
  font-size:28px;
  text-align:center;
  border-radius:8px;
}

/* ======================
   BLOQUE LOTES
   ====================== */

.lotes-container{
  margin-top: 25px;
  display: grid;
  gap: 10px;
}

.lote-row{
  display: grid;
  grid-template-columns: 1fr 80px;
  align-items: center;
  gap: 10px;
}

.lote-numeros{
  height: 55px;
  border-radius: 10px;
  background: #111;
  border: 3px solid #444;
  color: #fff;
  font-size: 26px;
  font-weight: bold;
  text-align: center;
  letter-spacing: 6px;
}

.lote-caramelos{
  height: 55px;
  border-radius: 10px;
  background: #222;
  border: 3px solid #888;
  color: yellow;
  font-size: 34px;
  font-weight: bold;
  text-align: center;
}
</style>
</head>

<body>

<h1>ðŸŽ¡ Sistema Premium S77</h1>

<!-- LOGIN -->
<div class="panel" id="login">
  <h2>INGRESAR CLAVE</h2>
  <input id="clave">
  <br>
  <button onclick="login()">INGRESAR</button>
  <p id="error" style="color:red;"></p>
</div>

<!-- ADMIN -->
<div class="panel hidden" id="admin">
  <h2>ADMINISTRADOR</h2>
  <input id="nuevaClave" placeholder="Clave usuario">
  <select id="dias">
    <option value="1">1 dÃ­a</option>
    <option value="7">7 dÃ­as</option>
    <option value="30">30 dÃ­as</option>
  </select>
  <br>
  <button onclick="crearUsuario()">CREAR USUARIO</button>
</div>

<!-- S77 -->
<div class="panel hidden" id="s77">

  <h2>ÃšLTIMOS NÃšMEROS</h2>

  <div id="zonaNumeros">
    <!-- Vista inicial: 16 casilleros -->
    <div class="inputs" id="vista16">
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
    </div>

    <!-- Vista final: solo 5 casilleros -->
    <div class="inputs5 hidden" id="vista5">
      <input disabled>
      <input disabled>
      <input disabled>
      <input disabled>
      <input disabled>
    </div>
  </div>

  <h3>NUEVO NÃšMERO</h3>

  <div style="display:flex; justify-content:center; gap:20px; align-items:flex-start;">
    <div>
      <input class="nuevo" id="nuevoNumero" type="number">
      <br>
      <button onclick="reiniciar()">REINICIAR</button>
    </div>

    <div class="totalBox">
      <div><strong>TOTAL</strong></div>
      <input id="total" disabled>
      <br><br>
      <div><strong>FICHAS</strong></div>
      <input id="fichas" disabled>
    </div>
  </div>

  <!-- ==============================
       LOTES â€” VISUAL
       ============================== -->

  <h3 style="margin-top:25px;">LOTE â€” BUSQUEDAS & CARAMELOS</h3>

  <div class="lotes-container" id="zonaLotes">

    <div class="lote-row"><input class="lote-numeros" id="loteA_nums" placeholder="Lote A"><input class="lote-caramelos" id="loteA_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteB_nums" placeholder="Lote B"><input class="lote-caramelos" id="loteB_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteC_nums" placeholder="Lote C"><input class="lote-caramelos" id="loteC_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteD_nums" placeholder="Lote D"><input class="lote-caramelos" id="loteD_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteE_nums" placeholder="Lote E"><input class="lote-caramelos" id="loteE_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteF_nums" placeholder="Lote F"><input class="lote-caramelos" id="loteF_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteG_nums" placeholder="Lote G"><input class="lote-caramelos" id="loteG_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteH_nums" placeholder="Lote H"><input class="lote-caramelos" id="loteH_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteI_nums" placeholder="Lote I"><input class="lote-caramelos" id="loteI_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteJ_nums" placeholder="Lote J"><input class="lote-caramelos" id="loteJ_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteK_nums" placeholder="Lote K"><input class="lote-caramelos" id="loteK_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteL_nums" placeholder="Lote L"><input class="lote-caramelos" id="loteL_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteM_nums" placeholder="Lote M"><input class="lote-caramelos" id="loteM_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteN_nums" placeholder="Lote N"><input class="lote-caramelos" id="loteN_car" placeholder="-"></div>
    <div class="lote-row"><input class="lote-numeros" id="loteO_nums" placeholder="Lote O"><input class="lote-caramelos" id="loteO_car" placeholder="-"></div>

  </div>

  <h3>FAVORITOS</h3>
  <div class="favoritos" id="fav">â€”</div>

  <h3>EXPLOSIVOS</h3
  ><div class="explosivos" id="exp">â€”</div>

</div>

<script>
const API = "https://s77-backend.onrender.com";
let ultimos = [];
let adminClave = null;
let totalAcumulado = 0;

const cas16 = [...document.querySelectorAll("#vista16 input")];
const cas5 = [...document.querySelectorAll("#vista5 input")];

async function login(){
  const clave = document.getElementById("clave").value;

  const r = await fetch(API + "/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ clave })
  });

  const d = await r.json();

  if (!d.ok) {
    document.getElementById("error").innerText = d.error || "FORBIDDEN";
    return;
  }

  document.getElementById("login").classList.add("hidden");
  document.getElementById("s77").classList.remove("hidden");

  if (d.admin) {
    adminClave = clave;
    document.getElementById("admin").classList.remove("hidden");
  }
}

async function crearUsuario(){
  const nuevaClave = document.getElementById("nuevaClave").value;
  const dias = document.getElementById("dias").value;

  await fetch(API + "/crear-usuario", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ adminClave, nuevaClave, dias })
  });

  alert("Usuario creado");
}

document.getElementById("nuevoNumero").onchange = async e => {
  const v = parseInt(e.target.value);
  if (isNaN(v)) return;

  ultimos.unshift(v);
  if (ultimos.length > 16) ultimos.pop();

  render();

  if (ultimos.length >= 16){

    const r = await fetch(API + "/calcular", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ultimos })
    });

    const d = await r.json();

    if (d.completed) totalAcumulado = 0;

    totalAcumulado += d.favoritos.length + d.explosivos.length;

    document.getElementById("total").value = totalAcumulado;
    document.getElementById("fichas").value = totalAcumulado > 36 ? 2 : 1;

    document.getElementById("fav").innerText =
      d.favoritos.length ? d.favoritos.join(", ") : "â€”";

    document.getElementById("exp").innerText =
      d.explosivos.length ? d.explosivos.join(", ") : "â€”";
  }

  e.target.value = "";
};

function render(){
  cas16.forEach((c,i)=> c.value = ultimos[i] ?? "");

  if (ultimos.length >= 16){

    const vista16 = document.getElementById("vista16");
    const vista5 = document.getElementById("vista5");

    if (vista16) vista16.remove();

    vista5.classList.remove("hidden");

    const ult5 = ultimos.slice(0,5);
    cas5.forEach((c,i)=> c.value = ult5[i] ?? "");
  }
}

function reiniciar(){
  ultimos = [];
  totalAcumulado = 0;

  document.getElementById("total").value = "";
  document.getElementById("fichas").value = "";
  fav.innerText = "â€”";
  exp.innerText = "â€”";

  location.reload();
}

/* ============================
   LOTES â€” VISUAL (A y B)
   ============================ */

const LOTES = {
  A: [
    { pareja:[6,10], busca:[13,36,27] },
    { pareja:[6,5],  busca:[13,36,27] },
    { pareja:[6,24], busca:[13,36,27] }
  ],
  B: [
    { pareja:[7,19], busca:[6,27,13] },
    { pareja:[7,4],  busca:[6,27,13] },
    { pareja:[7,15], busca:[6,27,13] }
  ]
};

function mostrarLotes(){
  document.getElementById("loteA_nums").value = LOTES.A[0].busca.slice(0,5).join(" ");
  document.getElementById("loteB_nums").value = LOTES.B[0].busca.slice(0,5).join(" ");

  document.getElementById("loteA_car").value = "";
  document.getElementById("loteB_car").value = "";
}

mostrarLotes();
</script>

</body>
                            </html>
  
