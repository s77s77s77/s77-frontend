<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema Premium S77</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:black;
  color:#fff;
  text-align:center;
  padding:20px;
}
.panel{max-width:520px;margin:15px auto;padding:15px;border-radius:12px;background:black}
.hidden{display:none}
input,button{padding:10px;border-radius:8px;border:none;margin:5px}
button{background:maroon;color:white;font-weight:bold}

.inputs{
  display:grid;
  grid-template-columns:repeat(4,70px);
  gap:12px;
  justify-content:center;
}
.inputs input{
  width:70px;height:70px;font-size:34px;font-weight:bold;text-align:center;
  border:4px solid red;background:white;color:black;
}

.inputs5{
  display:flex;flex-direction:column;gap:8px;margin:0;
}
.inputs5 input{
  width:55px;height:55px;font-size:26px;font-weight:bold;text-align:center;
  border:3px solid red;background:white;color:black;
}

.nuevo{
  width:70px;height:70px;font-size:34px;text-align:center;
  border:4px solid red;background:#7fd3ff;
}

.tablero{
  margin-top:20px;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  gap:25px;
}

.lotes-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.lote-box{display:grid;grid-template-columns:1fr 70px;gap:10px}
.lote-numeros{
  height:55px;border-radius:10px;background:#111;border:3px solid #444;
  color:#fff;font-size:22px;font-weight:bold;text-align:center;
}
.lote-caramelos{
  height:55px;border-radius:10px;background:#222;border:3px solid #888;
  color:yellow;font-size:26px;font-weight:bold;text-align:center;
}
</style>
</head>

<body>

<h1>ðŸŽ¡ Sistema Premium S77</h1>

<div class="panel" id="login">
  <h2>INGRESAR CLAVE</h2>
  <input id="clave">
  <br>
  <button onclick="login()">INGRESAR</button>
</div>

<div class="panel hidden" id="s77">

  <h3>NUEVO NÃšMERO</h3>

  <div style="display:flex;justify-content:center;">
    <div>
      <input class="nuevo" id="nuevoNumero" type="number">
      <br>
      <button onclick="reiniciar()">REINICIAR</button>
    </div>
  </div>

  <div id="zonaNumeros">
    <div class="inputs" id="vista16">
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
    </div>
  </div>

  <div class="tablero">

    <div class="inputs5 hidden" id="vista5">
      <input disabled>
      <input disabled>
      <input disabled>
      <input disabled>
      <input disabled>
    </div>

    <div class="lotes-grid" id="zonaLotes"></div>

  </div>

</div>

<script>
let ultimos = [];

const cas16=[...document.querySelectorAll("#vista16 input")];
const cas5=[...document.querySelectorAll("#vista5 input")];

function login(){
  document.getElementById("login").classList.add("hidden");
  document.getElementById("s77").classList.remove("hidden");
}

/*
 LOTE A â€” del archivo PRUEBA FINAL
 (solo para pruebas)
*/
const LOTES = {
  A:[
    { pareja:[6,34], busca:[27,5,10,24,13,36] },
    { pareja:[34,27], busca:[5,10,24,13,36,6] },
    { pareja:[27,5],  busca:[10,24,13,36,6,34] },
    { pareja:[5,10],  busca:[24,13,36,6,34,27] },
    { pareja:[10,24], busca:[13,36,6,34,27,5] },
    { pareja:[24,13], busca:[36,6,34,27,5,10] },
    { pareja:[13,36], busca:[6,34,27,5,10,24] }
  ]
};

/* estado del lote */
const estadoLotes = {
  A:{
    activo:false,
    pareja:null,
    busca:[],
    ultimoCierrePos:null,   // posiciÃ³n donde se cerrÃ³
    bloqueado:false,
    slot:null
  }
};

/* crear casillero visual */
const zona=document.getElementById("zonaLotes");
const box=document.createElement("div");
box.className="lote-box";
box.innerHTML=`
  <input class="lote-numeros" id="lote_nums_A">
  <input class="lote-caramelos" disabled>
`;
zona.appendChild(box);
estadoLotes.A.slot=document.getElementById("lote_nums_A");

/* utilidades */
function posicionesDe(num){
  const pos=[];
  for(let i=0;i<ultimos.length;i++){
    if(ultimos[i]===num) pos.push(i);
  }
  return pos;
}

document.getElementById("nuevoNumero").onchange=e=>{
  const v=parseInt(e.target.value);
  if(isNaN(v)) return;

  ultimos.unshift(v);
  if(ultimos.length>16) ultimos.pop();

  render();
  controlarLoteA();
  e.target.value="";
};

function render(){
  cas16.forEach((c,i)=>c.value=ultimos[i]??"");

  if(ultimos.length>=16){
    const v16=document.getElementById("vista16");
    const v5=document.getElementById("vista5");
    if(v16) v16.remove();
    v5.classList.remove("hidden");

    const ult5=ultimos.slice(0,5);
    cas5.forEach((c,i)=>c.value=ult5[i]??"");
  }
}

/* ======================
   MOTOR SOLO LOTE A
   ====================== */
function controlarLoteA(){

  const st = estadoLotes.A;

  // si hay bÃºsqueda activa
  if(st.activo){

    // Â¿apareciÃ³ alguno de los "busca"?
    let encontrada = false;
    let posCierre = null;

    for(let i=0;i<ultimos.length;i++){
      if(st.busca.includes(ultimos[i])){
        encontrada = true;
        posCierre = i;
        break;
      }
    }

    if(encontrada){
      st.activo=false;
      st.slot.value="";
      st.ultimoCierrePos = posCierre;
      st.bloqueado = true;
      return;
    }

    return;
  }

  // si estÃ¡ bloqueado, verificamos si ya se puede volver a buscar
  if(st.bloqueado && st.ultimoCierrePos != null){

    // buscamos cualquier nÃºmero del lote en las posiciones actuales
    const numerosDelLote = [6,34,27,5,10,24,13,36];

    for(let i=0;i<ultimos.length;i++){
      if(numerosDelLote.includes(ultimos[i])){

        const dist = Math.abs(i - st.ultimoCierrePos);

        if(dist >= 7){
          st.bloqueado = false;   // se libera
        } else {
          return; // sigue bloqueado
        }
      }
    }
  }

  // si no hay bÃºsqueda activa â†’ intentar activar
  for(const p of LOTES.A){

    const posA = posicionesDe(p.pareja[0]);
    const posB = posicionesDe(p.pareja[1]);

    if(!posA.length || !posB.length) continue;

    let puede = false;

    for(const a of posA){
      for(const b of posB){

        const dist = Math.abs(a-b);
        const unoEn8 = (a<=7)||(b<=7);

        if(dist <= 8 && unoEn8){
          puede = true;
          break;
        }
      }
      if(puede) break;
    }

    if(puede){
      st.activo = true;
      st.pareja = p.pareja;
      st.busca = p.busca;
      st.slot.value = p.busca.join(" ");
      break;
    }
  }
}

function reiniciar(){location.reload();}
</script>

</body>
     </html>
 
