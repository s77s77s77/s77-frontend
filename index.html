<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema Premium S77</title>

<style>
body{
  font-family: Arial, sans-serif;
  background: black;
  color: #fff;
  text-align: center;
  padding: 20px;
}

.panel{
  max-width: 520px;
  margin: 15px auto;
  padding: 15px;
  border-radius: 12px;
  background: black;
}

.hidden{ display:none }

input,button{
  padding:10px;
  border-radius:8px;
  border:none;
  margin:5px;
}

button{
  background:maroon;
  color:white;
  font-weight:bold;
}

.inputs{
  display:grid;
  grid-template-columns:repeat(4,70px);
  gap:12px;
  justify-content:center;
}

.inputs input{
  width:70px;
  height:70px;
  font-size:34px;
  font-weight:bold;
  text-align:center;
  border:4px solid red;
  background:white;
  color:black;
}

/* Ãºltimos 5 */
.inputs5{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin:0;
  padding:0;
}
.inputs5 input{
  width:55px;
  height:55px;
  font-size:26px;
  font-weight:bold;
  text-align:center;
  border:3px solid red;
  background:white;
  color:black;
}

.nuevo{
  width:70px;
  height:70px;
  font-size:34px;
  text-align:center;
  border:4px solid red;
  background:#7fd3ff;
}

/* tablero */
.tablero{
  margin-top:20px;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  gap:25px;
}

/* lotes */
.lotes-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
}

.lote-box{
  display:grid;
  grid-template-columns: 1fr 70px;
  gap:10px;
}

.lote-numeros{
  height:55px;
  border-radius:10px;
  background:#111;
  border:3px solid #444;
  color:#fff;
  font-size:22px;
  font-weight:bold;
  text-align:center;
  letter-spacing:4px;
}

.lote-caramelos{
  height:55px;
  border-radius:10px;
  background:#222;
  border:3px solid #888;
  color:yellow;
  font-size:26px;
  font-weight:bold;
  text-align:center;
}
</style>
</head>

<body>

<h1>ðŸŽ¡ Sistema Premium S77</h1>

<div class="panel" id="login">
  <h2>INGRESAR CLAVE</h2>
  <input id="clave">
  <br>
  <button onclick="login()">INGRESAR</button>
  <p id="error" style="color:red;"></p>
</div>

<div class="panel hidden" id="s77">

  <h3>NUEVO NÃšMERO</h3>

  <div style="display:flex; justify-content:center;">
    <div>
      <input class="nuevo" id="nuevoNumero" type="number">
      <br>
      <button onclick="reiniciar()">REINICIAR</button>
    </div>
  </div>

  <div id="zonaNumeros">
    <div class="inputs" id="vista16">
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
      <input disabled><input disabled><input disabled><input disabled>
    </div>
  </div>

  <div class="tablero">

    <div class="inputs5 hidden" id="vista5">
      <input disabled>
      <input disabled>
      <input disabled>
      <input disabled>
      <input disabled>
    </div>

    <div class="lotes-grid" id="zonaLotes"></div>

  </div>

</div>

<script>
const API = "https://s77-backend.onrender.com";

let ultimos = [];

const cas16 = [...document.querySelectorAll("#vista16 input")];
const cas5  = [...document.querySelectorAll("#vista5 input")];

function login(){
  document.getElementById("login").classList.add("hidden");
  document.getElementById("s77").classList.remove("hidden");
}

/* ==============================
   LOTES (A â€” F DEL ARCHIVO)
   ============================== */

const LOTES = {
  A: [
    { pareja:[6,10], busca:[13,36,27] },
    { pareja:[6,5], busca:[13,36,27] },
    { pareja:[6,26], busca:[10,33,5] }
  ],
  B: [],
  C: [],
  D: [],
  E: [],
  F: []
};

/* estado dinÃ¡mico */
const estadoLotes = {};
Object.keys(LOTES).forEach((k,i)=>{
  estadoLotes[k] = {
    activo:false,
    pareja:null,
    busca:[],
    contador:0,
    slotNumeros: null
  };
});

const zona = document.getElementById("zonaLotes");
let loteIndex = 0;

Object.keys(LOTES).forEach(lote =>{
  const row = document.createElement("div");
  row.className = "lote-box";
  row.innerHTML = `
    <input class="lote-numeros" id="lote_nums_${lote}">
    <input class="lote-caramelos" id="lote_car_${lote}">
  `;
  zona.appendChild(row);
  estadoLotes[lote].slotNumeros = document.getElementById(`lote_nums_${lote}`);
});

/* ==============================
   MOTOR PRINCIPAL
   ============================== */

document.getElementById("nuevoNumero").onchange = e =>{
  const v = parseInt(e.target.value);
  if(isNaN(v)) return;

  ultimos.unshift(v);
  if(ultimos.length > 16) ultimos.pop();

  render();
  controlarLotes();

  e.target.value = "";
};

function render(){
  cas16.forEach((c,i)=> c.value = ultimos[i] ?? "");

  if(ultimos.length >= 16){
    const vista16 = document.getElementById("vista16");
    const vista5  = document.getElementById("vista5");

    if(vista16) vista16.remove();
    vista5.classList.remove("hidden");

    const ult5 = ultimos.slice(0,5);
    cas5.forEach((c,i)=> c.value = ult5[i] ?? "");
  }
}

/* ==============================
   ACTIVACIÃ“N SEGÃšN TUS REGLAS
   ============================== */

function controlarLotes(){

  Object.keys(LOTES).forEach(lote=>{

    const st = estadoLotes[lote];

    // si estÃ¡ activo â†’ revisar cancelaciÃ³n por regla
    if(st.activo){
      st.contador++;

      const pos1 = ultimos.indexOf(st.pareja[0]);
      const pos2 = ultimos.indexOf(st.pareja[1]);

      // si ya ninguno estÃ¡ dentro de 0..7 â†’ cancelar
      if( (pos1 === -1 || pos1 > 7) && (pos2 === -1 || pos2 > 7) ){
        st.activo = false;
        st.slotNumeros.value = "";
        return;
      }

      // si llegÃ³ a 8 tiradas â†’ termina
      if(st.contador >= 8){
        st.activo = false;
        st.slotNumeros.value = "";
      }

      return;
    }

    // si NO estÃ¡ activo â†’ buscar si alguna pareja debe activarse
    for(const p of LOTES[lote]){

      const pos1 = ultimos.indexOf(p.pareja[0]);
      const pos2 = ultimos.indexOf(p.pareja[1]);

      if(pos1 === -1 || pos2 === -1) continue;

      const dist = Math.abs(pos1 - pos2);

      const unoEnPrimerosOcho =
        (pos1 >=0 && pos1 <=7) ||
        (pos2 >=0 && pos2 <=7);

      if(dist <= 8 && unoEnPrimerosOcho){

        st.activo = true;
        st.pareja = p.pareja;
        st.busca  = p.busca;
        st.contador = 0;

        st.slotNumeros.value = p.busca.join(" ");
        break;
      }
    }

  });

}

function reiniciar(){
  location.reload();
}
</script>

</body>
</html>
